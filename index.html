<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>„Éë„ÉÅ„É≥„Ç≥</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRAGLrjEeqNmwwVpY-esZAxZMNgZK23-DPXt7zK1romRg&s=10" sizes="16√ó16" type="image/png" /> 
<style>
body{margin:0;background:#020617;color:#fff;font-family:sans-serif;text-align:center}
header{padding:10px;font-size:18px;font-weight:bold}
#game{position:relative;margin:auto;max-width:420px;height:640px;
 border:3px solid #38bdf8;border-radius:12px;overflow:hidden}
canvas{display:block}
#ui{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;padding:8px}
button{padding:8px 10px;border:none;border-radius:8px;
 background:#38bdf8;color:#000;font-weight:bold}

#lever{position:absolute;right:10px;bottom:60px;width:40px;height:160px;
 background:#334155;border-radius:20px}
#leverKnob{position:absolute;left:50%;transform:translateX(-50%);
 width:50px;height:50px;background:#facc15;border-radius:50%;top:0}

#bigWin{position:absolute;inset:0;display:none;align-items:center;
 justify-content:center;background:rgba(0,0,0,.85);z-index:5}
#bigWin span{font-size:42px;color:#facc15;
 animation:zoom 1s infinite alternate}
@keyframes zoom{to{transform:scale(1.3)}}

/* Êìç‰ΩúË™¨Êòé */
#help{
 position:absolute;
 left:8px;
 bottom:8px;
 background:rgba(0,0,0,0.6);
 border:1px solid rgba(255,255,255,0.2);
 border-radius:8px;
 padding:8px 10px;
 font-size:12px;
 line-height:1.4;
 text-align:left;
 z-index:10;
 pointer-events:none;
}
</style>
</head>
<body>

<header>„Éë„ÉÅ„É≥„Ç≥</header>

<div id="game">
 <canvas id="c" width="420" height="640"></canvas>
 <canvas id="rain" width="420" height="640"></canvas>

 <div id="lever"><div id="leverKnob"></div></div>

 <div id="bigWin"><span>üéâ Â§ßÂΩì„Åü„ÇäÔºÅ üéâ</span></div>

 <div id="help">
  <b>Êìç‰ΩúÊñπÊ≥ï</b><br>
  SpaceÔºöÁô∫Â∞Ñ<br>
  BÔºöBGM ON / OFF<br>
  FÔºö„Éï„É´„Çπ„ÇØ„É™„Éº„É≥<br>
  „É¨„Éê„ÉºÔºöÂºï„ÅÑ„Å¶Èõ¢„Åô
 </div>
</div>

<div id="ui">
 Áéâ:<span id="balls">100</span>
 <button id="shot">Áô∫Â∞Ñ</button>
 <button id="bgmBtn">BGM</button>
 <button id="saveBtn">SAVE</button>
 <button id="loadBtn">LOAD</button>
 <button id="delBtn">DEL</button>
 <button id="fsBtn">FULL</button>
</div>

<script>
/* ===== Canvas ===== */
const c=document.getElementById("c"),ctx=c.getContext("2d");
const rain=document.getElementById("rain"),rctx=rain.getContext("2d");
const game=document.getElementById("game");

/* ===== State ===== */
let balls=100,ballList=[],canShoot=true;
const ballsEl=document.getElementById("balls");
let gravity=0.22;

/* ===== ÂΩì„Åü„Çä„Çæ„Éº„É≥ ===== */
let zone={x:190,y:520,w:22,h:18,vx:2,vy:1.2,vis:true,t:0};

/* ===== Èáò ===== */
const pins=[];
for(let y=120;y<=420;y+=50){
 for(let x=80;x<=340;x+=50){
  pins.push({x,y,r:6});
 }
}

/* ===== BGM ===== */
let audioCtx,osc,bgm=false;
bgmBtn.onclick=()=>{
 if(!audioCtx) audioCtx=new AudioContext();
 audioCtx.resume();
 if(!bgm){
  osc=audioCtx.createOscillator();
  osc.frequency.value=160;
  osc.connect(audioCtx.destination);
  osc.start(); bgm=true;
 }else{
  osc.stop(); bgm=false;
 }
};

/* ===== Shoot ===== */
function shoot(){
 if(!canShoot||balls<=0) return;
 canShoot=false; setTimeout(()=>canShoot=true,500);
 balls--; ballsEl.textContent=balls;
 ballList.push({
  x:210,y:40,
  vx:(Math.random()-.5)*2,
  vy:2,hit:false
 });
}
shot.onclick=shoot;

/* ===== Lever ===== */
const knob=document.getElementById("leverKnob");
let drag=false,sy=0;
knob.onpointerdown=e=>{drag=true;sy=e.clientY;}
document.onpointerup=()=>{
 if(drag) shoot();
 knob.style.top="0"; drag=false;
}
document.onpointermove=e=>{
 if(drag) knob.style.top=Math.min(100,Math.max(0,e.clientY-sy))+"px";
}

/* ===== Keyboard ===== */
onkeydown=e=>{
 if(e.code==="Space") shoot();
 if(e.key==="f") game.requestFullscreen();
 if(e.key==="b") bgmBtn.onclick();
};

/* ===== BigWin ===== */
let confetti=[];
function bigWin(){
 document.getElementById("bigWin").style.display="flex";
 balls+=50; ballsEl.textContent=balls;
 for(let i=0;i<100;i++)
  confetti.push({
   x:210,y:300,
   vx:(Math.random()-.5)*6,
   vy:Math.random()*-6
  });
 setTimeout(()=>document.getElementById("bigWin").style.display="none",2000);
}

/* ===== Save ===== */
saveBtn.onclick=()=>localStorage.setItem("pachiSave",JSON.stringify({balls}));
loadBtn.onclick=()=>{
 const s=localStorage.getItem("pachiSave");
 if(!s) return;
 balls=JSON.parse(s).balls;
 ballsEl.textContent=balls;
};
delBtn.onclick=()=>localStorage.removeItem("pachiSave");

/* ===== Full ===== */
fsBtn.onclick=()=>game.requestFullscreen();

/* ===== Loop ===== */
function update(){
 zone.t++; if(zone.t%200===0) zone.vis=!zone.vis;
 if(zone.vis){
  zone.x+=zone.vx; zone.y+=zone.vy;
  if(zone.x<60||zone.x+zone.w>360) zone.vx*=-1;
  if(zone.y<480||zone.y+zone.h>580) zone.vy*=-1;
 }

 ctx.fillStyle="#020617";
 ctx.fillRect(0,0,420,640);

 /* pins */
 ctx.fillStyle="#94a3b8";
 pins.forEach(p=>{
  ctx.beginPath();
  ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
  ctx.fill();
 });

 /* zone */
 if(zone.vis){
  ctx.strokeStyle="#facc15";
  ctx.strokeRect(zone.x,zone.y,zone.w,zone.h);
 }

 /* balls */
 ctx.fillStyle="#e5e7eb";
 ballList.forEach(b=>{
  b.vy+=gravity;
  b.x+=b.vx; b.y+=b.vy;

  if(b.x<5||b.x>415) b.vx*=-1;

  pins.forEach(p=>{
   const dx=b.x-p.x,dy=b.y-p.y;
   const dist=Math.hypot(dx,dy);
   if(dist<p.r+4){
    const ang=Math.atan2(dy,dx);
    b.vx=Math.cos(ang)*2;
    b.vy=Math.sin(ang)*2;
   }
  });

  if(!b.hit&&zone.vis &&
   b.x>zone.x&&b.x<zone.x+zone.w &&
   b.y>zone.y&&b.y<zone.y+zone.h){
    b.hit=true; bigWin(); b.y=700;
  }

  ctx.beginPath();
  ctx.arc(b.x,b.y,4,0,Math.PI*2);
  ctx.fill();
 });

 ballList=ballList.filter(b=>b.y<660);

 /* confetti */
 rctx.clearRect(0,0,420,640);
 confetti.forEach(p=>{
  p.vy+=0.2; p.x+=p.vx; p.y+=p.vy;
  rctx.fillStyle="#facc15";
  rctx.fillRect(p.x,p.y,4,4);
 });
 confetti=confetti.filter(p=>p.y<660);

 requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
