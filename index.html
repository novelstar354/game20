<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>HTML ãƒ‘ãƒãƒ³ã‚³ ãƒ•ãƒ«çµ±åˆç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body{
 margin:0;
 background:#020617;
 color:#fff;
 font-family:sans-serif;
 text-align:center;
}
h1{margin:8px 0}
#ui{
 display:flex;
 justify-content:center;
 gap:6px;
 flex-wrap:wrap;
 margin-bottom:6px;
}
button,select{
 padding:8px 12px;
 border:none;
 border-radius:8px;
 font-size:14px;
}
button{background:#22c55e;color:#000}
select{background:#0f172a;color:#fff}
canvas{
 background:#0f172a;
 margin:auto;
 display:block;
 border:3px solid #facc15;
 border-radius:14px;
}
#lever{
 width:60px;
 height:200px;
 background:#334155;
 margin:10px auto;
 border-radius:30px;
 position:relative;
 touch-action:none;
}
#knob{
 width:50px;
 height:50px;
 background:#facc15;
 border-radius:50%;
 position:absolute;
 left:5px;
 top:10px;
}
#jackpot{
 position:absolute;
 inset:0;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:48px;
 background:rgba(0,0,0,0.6);
 display:none;
}
</style>
</head>
<body>

<h1>ğŸ° ãƒ‘ãƒãƒ³ã‚³</h1>

<div id="ui">
 ç‰: <span id="balls">50</span>
 <button onclick="toggleSound()">ğŸ”Š</button>
 <button onclick="resetSave()">ğŸ—‘ ã‚»ãƒ¼ãƒ–å‰Šé™¤</button>
 <select id="pegPower">
  <option value="0.04">é‡˜ï¼šå¼±</option>
  <option value="0.07" selected>é‡˜ï¼šä¸­</option>
  <option value="0.12">é‡˜ï¼šå¼·</option>
 </select>
 <button onclick="toggleFull()">FULL</button>
</div>

<canvas id="game" width="360" height="600"></canvas>

<div id="lever">
 <div id="knob"></div>
</div>

<div id="jackpot">ğŸ‰ å¤§å½“ãŸã‚Š ğŸ‰</div>

<!-- éŸ³ -->
<audio id="bgm" loop src="https://cdn.pixabay.com/audio/2022/10/03/audio_1b2f0d6d53.mp3"></audio>
<audio id="se" src="https://cdn.pixabay.com/audio/2022/03/15/audio_9a6bdf6e5d.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const bgm = document.getElementById("bgm");
const se = document.getElementById("se");

let balls = Number(localStorage.getItem("balls")) || 50;
document.getElementById("balls").textContent = balls;

let soundOn=true;
bgm.volume=0.4;
se.volume=0.7;
bgm.play();

const gravity=0.25;
let activeBalls=[];
let flash=0;

const pegs=[];
for(let y=80;y<520;y+=60){
 for(let x=60;x<300;x+=60){
  pegs.push({x:x+(y%120?30:0),y});
 }
}
const pocket={x:180,y:560,r:28};

class Ball{
 constructor(power){
  this.x=180;
  this.y=30;
  this.vx=(Math.random()-0.5)*power;
  this.vy=2;
  this.r=5;
 }
 update(){
  this.vy+=gravity;
  this.x+=this.vx;
  this.y+=this.vy;
  if(this.x<this.r||this.x>canvas.width-this.r) this.vx*=-0.9;

  const pegForce=Number(document.getElementById("pegPower").value);
  for(const p of pegs){
   const dx=this.x-p.x,dy=this.y-p.y;
   const d=Math.hypot(dx,dy);
   if(d<12){
    this.vx+=dx*pegForce;
    this.vy+=dy*pegForce;
   }
  }
  const dx=this.x-pocket.x,dy=this.y-pocket.y;
  if(Math.hypot(dx,dy)<pocket.r){
   jackpot();
   return false;
  }
  return this.y<canvas.height+20;
 }
 draw(){
  ctx.fillStyle="#e5e7eb";
  ctx.beginPath();
  ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
  ctx.fill();
 }
}

function jackpot(){
 balls+=50;
 flash=30;
 document.getElementById("jackpot").style.display="flex";
 if(soundOn) se.play();
 setTimeout(()=>document.getElementById("jackpot").style.display="none",1200);
 save();
}

function launch(power=3){
 if(balls<=0) return;
 balls--;
 activeBalls.push(new Ball(power));
 document.getElementById("balls").textContent=balls;
 save();
}

function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 if(flash>0){
  ctx.fillStyle="rgba(250,204,21,0.2)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  flash--;
 }
 ctx.fillStyle="#94a3b8";
 pegs.forEach(p=>{
  ctx.beginPath();
  ctx.arc(p.x,p.y,4,0,Math.PI*2);
  ctx.fill();
 });
 ctx.fillStyle="#ef4444";
 ctx.beginPath();
 ctx.arc(pocket.x,pocket.y,pocket.r,0,Math.PI*2);
 ctx.fill();

 activeBalls=activeBalls.filter(b=>{
  b.draw();
  return b.update();
 });
 requestAnimationFrame(draw);
}
draw();

function save(){
 localStorage.setItem("balls",balls);
}
function resetSave(){
 localStorage.removeItem("balls");
 location.reload();
}
function toggleSound(){
 soundOn=!soundOn;
 soundOn?bgm.play():bgm.pause();
}
function toggleFull(){
 document.fullscreenElement?document.exitFullscreen():canvas.requestFullscreen();
}

document.addEventListener("keydown",e=>{
 if(e.code==="Space") launch();
 if(e.key==="f") toggleFull();
});

/* ä»®æƒ³ãƒ¬ãƒãƒ¼ */
const lever=document.getElementById("lever");
const knob=document.getElementById("knob");
let dragging=false,startY=0;

lever.addEventListener("pointerdown",e=>{
 dragging=true;
 startY=e.clientY;
});
window.addEventListener("pointermove",e=>{
 if(!dragging) return;
 let dy=Math.min(120,Math.max(0,e.clientY-startY));
 knob.style.top=10+dy+"px";
});
window.addEventListener("pointerup",e=>{
 if(!dragging) return;
 dragging=false;
 let power=2+Number(knob.style.top.replace("px","")||0)/40;
 knob.style.top="10px";
 launch(power);
});
</script>
</body>
</html>
